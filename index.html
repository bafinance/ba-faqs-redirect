<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FAQs ‚Äî BA Information Technology Services</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --accent:#0f62fe;--bg:#f3f4f6;--card:#ffffff;--text:#1f2937;
      --muted:#6c7680;--border:#e6e9ee;--maxw:1150px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:var(--maxw);margin:18px auto;padding:12px}
    .banner{display:flex;align-items:center;justify-content:center;border-radius:10px;overflow:hidden;background:#111;padding:8px;margin-bottom:14px;box-shadow:0 8px 30px rgba(6,16,48,0.06)}
    .banner img{width:100%;height:auto;max-height:260px;object-fit:contain;display:block}
    .layout{display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:start}
    @media(max-width:920px){.layout{grid-template-columns:1fr}}
    .left{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 26px rgba(10,20,40,0.04);border:1px solid var(--border);height:100%}
    .right{display:flex;flex-direction:column;gap:12px}
    .heading{font-size:20px;font-weight:800;margin:4px 0 12px 0;color:#0b1220}
    .searchBox{display:flex;gap:8px;align-items:center;background:#f2f4f8;padding:10px;border-radius:12px;border:1px solid var(--border)}
    .searchBox input{border:0;outline:none;background:transparent;font-size:14px;width:100%}
    .list{display:flex;flex-direction:column;gap:8px;max-height:420px;overflow:auto;padding-right:6px}
    .faqItem{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px;cursor:pointer;transition:all .18s;color:inherit;text-decoration:none}
    .faqItem:hover{background:rgba(15,98,254,0.04);transform:translateY(-2px)}
    .imagesCard{background:var(--card);border-radius:10px;padding:12px;border:1px solid var(--border);box-shadow:0 10px 24px rgba(10,20,40,0.03)}
    .imgStack{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .imgWrap{height:260px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid var(--border)}
    .imgWrap img{max-width:100%;max-height:100%;object-fit:contain;display:block;opacity:0;transition:opacity .36s ease-in-out}
    .qaCard{background:var(--card);border-radius:12px;padding:18px;border:1px solid var(--border);box-shadow:0 8px 28px rgba(10,20,40,0.04)}
    .qaTitle{font-size:24px;font-weight:800;margin-bottom:8px;color:#0c2446}
    .qaBody{font-size:15px;color:#333;white-space:pre-wrap;line-height:1.6;padding:12px;border-radius:8px;background:#fff;border:1px solid var(--border);min-height:160px;opacity:0;transform:translateY(8px);transition:all .32s ease}
    .qaBody.show{opacity:1;transform:none}
    .actionsRow{display:flex;gap:10px;align-items:center;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--accent)}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#f3f6ff;border:1px solid #e9f0ff;font-weight:700;color:#0b3a91}
    .small{font-size:13px;color:var(--muted)}
    .allToggle{cursor:pointer;color:var(--muted);font-weight:700;margin-top:8px}
    .suggestBox{position:absolute;left:0;right:0;background:#fff;border:1px solid var(--border);border-radius:10px;z-index:80;max-height:260px;overflow:auto;padding:6px;margin-top:6px;box-shadow:0 12px 36px rgba(10,20,40,0.06)}
    .suggestItem{padding:8px;border-radius:8px;cursor:pointer}
    .suggestItem:hover{background:#f4f7ff}
    .footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="banner"><img id="headerImg" src="header.png" alt="BA Information Technology Services"></div>

    <div class="layout">
      <div class="left">
        <div class="heading">Frequently Asked Questions</div>

        <div style="position:relative;margin-bottom:10px;">
          <div class="searchBox">
            <input id="searchInput" placeholder="Search by tag, question, or answer">
            <button id="refreshBtn" class="btn ghost" style="margin-left:6px">Refresh</button>
          </div>
          <div id="suggestions" style="display:none"></div>
        </div>

        <div style="font-weight:800;margin-bottom:8px">Top FAQs</div>
        <div id="top5" class="list"></div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800">All FAQs</div>
          <div id="toggleAllBtn" class="allToggle">‚ñ∏</div>
        </div>
        <div id="allList" class="list" style="margin-top:8px;display:none"></div>
      </div>

      <div class="right">
        <!-- Landing images area (two static images from repo) -->
        <div class="imagesCard" id="landingImages">
          <div class="imgStack">
            <div class="imgWrap"><img id="svcImg1" src="services1.png" alt="Service image 1"></div>
            <div class="imgWrap"><img id="svcImg2" src="services2.png" alt="Service image 2"></div>
          </div>
        </div>

        <div id="qaCard" class="qaCard">
          <div id="qaTitle" class="qaTitle">Select a question to view the answer</div>
          <div id="qaBody" class="qaBody">Answers will appear here.</div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
            <div style="display:flex;gap:8px;align-items:center">
              <div id="approveBtn" class="pill">üëç Helpful</div>
              <div id="disapproveBtn" class="pill">üëé Not helpful</div>
            </div>
            <div class="small">Your feedback helps us improve ‚Äî thank you.</div>
          </div>

          <div class="actionsRow">
            <button id="openAllBtn" class="btn ghost">Show all</button>
            <button id="exitBtn" class="btn primary" style="margin-left:auto">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">BA Information Technology Services</div>
  </div>

<script>
/* CONFIG */
const FAQ_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQOB7XYnfn0V6i8HkQQc7nXDv7nDL-s0TN_tJdpBU-tQgOQh-4sTv6vOc5_CZf6ldK5RsjcAZfiMTiD/pub?gid=0&single=true&output=csv";

/* HELPERS */
function parseCsv(text){
  const lines = text.split(/\r?\n/).filter(l=>l.trim().length>0);
  return lines.map(line => line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/^"(.*)"$/, '$1')));
}
function headerMap(row){ const map={}; row.forEach((h,i)=> map[String(h||'').toLowerCase().trim()] = i); return map; }
function normalize(s){ return String(s||'').toLowerCase().trim(); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

/* UI refs */
const top5El = document.getElementById('top5');
const allListEl = document.getElementById('allList');
const qaTitleEl = document.getElementById('qaTitle');
const qaBodyEl = document.getElementById('qaBody');
const searchInput = document.getElementById('searchInput');
const suggestionsWrap = document.getElementById('suggestions');
const toggleAllBtn = document.getElementById('toggleAllBtn');
const landingImages = document.getElementById('landingImages');
const svcImg1 = document.getElementById('svcImg1');
const svcImg2 = document.getElementById('svcImg2');

let allFaqs = [], visibleFaqs = [], topFaqs = [], currentFaq = null;

/* Build FAQ objects using your exact columns:
   B: Question, C: Answer, D: Tags, F: Order, G: Visible
*/
function buildFaqObjects(rows){
  const hmap = headerMap(rows[0]);
  const i_question = hmap['question'] ?? 1;
  const i_answer = hmap['answer'] ?? 2;
  const i_tags = hmap['tags'] ?? 3;
  const i_order = hmap['order'] ?? 5;
  const i_visible = hmap['visible'] ?? 6;

  const out = [];
  for(let r=1;r<rows.length;r++){
    const row = rows[r];
    const question = (row[i_question]||'').toString().trim();
    if(!question) continue;
    const visibleRaw = (row[i_visible]||'').toString().trim().toLowerCase();
    if(visibleRaw === 'false' || visibleRaw === '0' || visibleRaw === 'no') continue;
    const obj = {
      id: (row[0] || ('faq_'+r)).toString(),
      question: question,
      answer: (row[i_answer]||'').toString(),
      tags: (row[i_tags]||'').toString(),
      order: Number(row[i_order]||0) || 0,
      rowIndex: r
    };
    out.push(obj);
  }
  out.sort((a,b)=> (b.order||0) - (a.order||0));
  return out;
}

/* render left lists */
function renderLeft(){
  top5El.innerHTML = '';
  topFaqs.forEach(f=>{
    const a = document.createElement('a'); a.className='faqItem'; a.href='javascript:void(0)';
    a.innerHTML = '<strong>'+escapeHtml(f.question)+'</strong>';
    a.addEventListener('click', ()=> openFaq(f));
    top5El.appendChild(a);
  });

  allListEl.innerHTML = '';
  visibleFaqs.forEach(f=>{
    const a = document.createElement('a'); a.className='faqItem'; a.href='javascript:void(0)';
    a.innerHTML = '<strong>'+escapeHtml(f.question)+'</strong>';
    a.addEventListener('click', ()=> openFaq(f));
    allListEl.appendChild(a);
  });
}

/* open FAQ: hide landing images, show answer */
function openFaq(f){
  currentFaq = f;
  landingImages.style.display = 'none';
  qaTitleEl.textContent = f.question || 'No question';
  qaBodyEl.textContent = f.answer || '-';
  qaBodyEl.classList.add('show');
}

/* search preferring tags */
function searchFaqs(q){
  const s = normalize(q);
  if(!s) return visibleFaqs;
  const tokens = s.split(/\s+/).filter(Boolean);
  const tagMatches = visibleFaqs.filter(f=>{
    if(!f.tags) return false;
    const tagsNormalized = f.tags.toLowerCase();
    return tokens.some(t => tagsNormalized.indexOf(t) !== -1);
  });
  if(tagMatches.length) return tagMatches;
  return visibleFaqs.filter(f => (f.question + ' ' + f.answer).toLowerCase().indexOf(s) !== -1);
}

/* UI wiring */
document.getElementById('refreshBtn').addEventListener('click', ()=> loadFaqs(true));
document.getElementById('openAllBtn').addEventListener('click', ()=> { allListEl.style.display='block'; toggleAllBtn.textContent='‚ñæ'; });
toggleAllBtn.addEventListener('click', ()=>{
  if(!allListEl.style.display || allListEl.style.display==='none'){ allListEl.style.display='block'; toggleAllBtn.textContent='‚ñæ'; }
  else { allListEl.style.display='none'; toggleAllBtn.textContent='‚ñ∏'; }
});
document.getElementById('exitBtn').addEventListener('click', ()=>{
  currentFaq = null;
  qaTitleEl.textContent = 'Select a question to view the answer';
  qaBodyEl.textContent = 'Answers will appear here.';
  qaBodyEl.classList.remove('show');
  landingImages.style.display = 'block';
});
document.getElementById('approveBtn').addEventListener('click', ()=> { if(!currentFaq) return alert('Select a question first.'); alert('Thanks ‚Äî recorded.'); });
document.getElementById('disapproveBtn').addEventListener('click', ()=> { if(!currentFaq) return alert('Select a question first.'); const note=prompt('Feedback (optional)'); if(note) alert('Thanks ‚Äî recorded.'); });

let searchTimer;
searchInput.addEventListener('input',(e)=>{
  clearTimeout(searchTimer);
  const q = e.target.value || '';
  searchTimer = setTimeout(()=>{
    if(!q.trim()){ renderLeft(); suggestionsWrap.style.display='none'; return; }
    const matches = searchFaqs(q);
    suggestionsWrap.innerHTML = '';
    if(matches && matches.length){
      const box = document.createElement('div'); box.className='suggestBox';
      matches.slice(0,12).forEach(m=>{
        const d = document.createElement('div'); d.className='suggestItem'; d.textContent = m.question;
        d.addEventListener('click', ()=> { openFaq(m); suggestionsWrap.style.display='none'; searchInput.value=''; });
        box.appendChild(d);
      });
      suggestionsWrap.appendChild(box); suggestionsWrap.style.display='block';
    } else { suggestionsWrap.style.display='none'; }
    allListEl.innerHTML = '';
    (matches || []).forEach(f=>{
      const a = document.createElement('a'); a.className='faqItem'; a.href='javascript:void(0)';
      a.innerHTML = '<strong>'+escapeHtml(f.question)+'</strong>';
      a.addEventListener('click', ()=> openFaq(f));
      allListEl.appendChild(a);
    });
    allListEl.style.display='block'; toggleAllBtn.textContent='‚ñæ';
  },160);
});

/* load CSV and init */
async function loadFaqs(force=false){
  try{
    const res = await fetch(FAQ_CSV_URL, {cache: force ? 'no-store' : 'default'});
    if(!res.ok) throw new Error('fetch failed: ' + res.status);
    const txt = await res.text();
    const rows = parseCsv(txt);
    if(rows.length < 2){ top5El.innerHTML='<div class="small">No FAQs found</div>'; return; }
    allFaqs = buildFaqObjects(rows);
    visibleFaqs = allFaqs.slice();
    topFaqs = visibleFaqs.slice(0,5);
    renderLeft();
    // show landing images by default; open first top if you want:
    landingImages.style.display = 'block';
    // optionally open the first top FAQ automatically:
    // if(topFaqs.length) openFaq(topFaqs[0]);
  } catch(err){
    console.error(err);
    top5El.innerHTML = '<div class="small">Unable to load FAQs ‚Äî check published CSV URL and network.</div>';
  }
}

/* preload landing images fade-in */
function fadeLandingImgs(){
  [svcImg1, svcImg2].forEach(img=>{
    const tmp = new Image();
    tmp.onload = ()=> img.style.opacity = 1;
    tmp.onerror = ()=> img.style.opacity = 1;
    tmp.src = img.src;
  });
}

/* start */
loadFaqs().then(()=> fadeLandingImgs());
</script>
</body>
</html>
