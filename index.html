<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FAQs ‚Äî BA Information Technology Services</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --accent:#0f62fe;
      --bg:#f3f4f6;
      --text:#102027;
      --muted:#6c7680;
      --card:#ffffff;
      --border:#e6e9ee;
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,Roboto,Arial,sans-serif;margin:0;color:var(--text);background:var(--bg);}
    .page{max-width:var(--maxw);margin:20px auto;padding:10px;}
    .header{display:flex;justify-content:center;margin-bottom:14px}
    .header img{width:100%;max-width:1000px;height:auto;object-fit:contain;border-radius:6px;box-shadow:0 6px 24px rgba(2,6,23,0.06)}
    .layout{display:flex;gap:18px}
    .left{width:320px;min-width:260px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 28px rgba(10,20,40,0.06);border:1px solid var(--border)}
    .pageTitle{font-size:20px;font-weight:800;margin-bottom:10px}
    .searchBox{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .searchBox input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:#f6f7f9;outline:none}
    .btn{padding:8px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .smallBtn{padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .sectionTitle{font-weight:800;margin:12px 0 8px 0}
    .faqList{display:flex;flex-direction:column;gap:8px}
    .faqItem{padding:10px;border-radius:8px;border:1px solid transparent;background:transparent;cursor:pointer}
    .faqItem:hover{background:#fbfcff}
    .faqItem.active{background:#f0f6ff;border-color:#e2efff}
    .right{flex:1;display:flex;flex-direction:column;gap:14px}
    .heroBox{height:260px;border-radius:10px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;overflow:hidden;background:#fff}
    .heroBox img{max-width:100%;max-height:100%;object-fit:contain}
    .answerCard{min-height:220px;border-radius:10px;border:1px solid var(--border);padding:20px;background:#fff}
    .qaTitle{font-size:22px;font-weight:800;margin-bottom:8px}
    .qaBody{white-space:pre-wrap;color:#223;line-height:1.55;padding:12px;border-radius:8px;background:#fbfdff;border:1px solid #eef6ff;min-height:120px}
    .actionsRow{display:flex;gap:10px;align-items:center;margin-top:12px}
    .chip{display:inline-block;padding:8px 12px;border-radius:999px;font-weight:700;color:#fff}
    .pending{background:#0a6bff}
    .reviewing{background:#7c3aed}
    .clarification{background:#a16207}
    .failed{background:#d93025}
    .succeeded{background:#16a34a}
    .meta{color:var(--muted);font-size:13px;margin-top:6px}
    .viewAll{margin-top:10px;display:block;color:var(--accent);text-decoration:none;font-weight:700}
    footer{margin-top:18px;text-align:center;color:#b6bec7;font-size:13px}
    @media(max-width:900px){.layout{flex-direction:column}.left{width:auto}}
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <img src="header.png" alt="BA Information Technology Services">
    </div>

    <div class="layout">
      <div class="left">
        <div class="card">
          <div class="pageTitle">Frequently Asked Questions</div>
          <div class="searchBox">
            <input id="searchInput" placeholder="Search FAQs (question or answer or tag)">
            <button id="refreshBtn" class="smallBtn">Refresh</button>
          </div>

          <div>
            <div class="sectionTitle">Top FAQs</div>
            <div id="topFaqs" class="faqList"></div>
          </div>

          <div style="margin-top:14px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="sectionTitle">All FAQs</div>
              <a id="toggleAll" style="cursor:pointer;color:var(--muted)">‚ñ∏</a>
            </div>
            <div id="allFaqs" class="faqList" style="display:none;margin-top:8px;max-height:520px;overflow:auto"></div>
            <a id="viewAllBtn" class="viewAll" href="#" style="display:block">View all FAQs (expand)</a>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="heroBox card" id="heroBox">
          <!-- show two landing images when no FAQ selected -->
          <div id="landingImages" style="display:flex;gap:12px;align-items:center;justify-content:center;width:100%">
            <img src="services1.png" alt="Service image 1" style="max-height:220px;object-fit:contain;border-radius:6px">
            <img src="services2.png" alt="Service image 2" style="max-height:220px;object-fit:contain;border-radius:6px">
          </div>
        </div>

        <div class="card answerCard" id="answerCard" style="display:none">
          <div id="statusRow" style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px">
            <div>
              <div id="qaTitle" class="qaTitle">Select a question to view the answer</div>
            </div>
            <div style="text-align:right">
              <div id="statusChip" class="chip pending" style="display:none">Status</div>
              <div id="lastUpdated" class="meta" style="display:none"></div>
            </div>
          </div>

          <div id="qaBody" class="qaBody" style="margin-top:12px">When you select a question the answer will appear here.</div>

          <div class="actionsRow">
            <button id="helpfulBtn" class="smallBtn">üëç Helpful</button>
            <button id="notHelpfulBtn" class="smallBtn">üëé Not helpful</button>
            <div style="flex:1"></div>
            <button id="closeBtn" class="smallBtn">Close</button>
          </div>
        </div>
      </div>
    </div>

    <footer>BA Information Technology Services</footer>
  </div>

<script>
/* ------------- CONFIG ------------- */
/* Put your published CSV URL for the FAQs sheet here (CSV output) */
const FAQ_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQOB7XYnfn0V6i8HkQQc7nXDv7nDL-s0TN_tJdpBU-tQgOQh-4sTv6vOc5_CZf6ldK5RsjcAZfiMTiD/pub?gid=0&single=true&output=csv";
/* ----------- END CONFIG ----------- */

/* Robust CSV parser that handles quoted fields and newlines inside quotes.
   Returns array of rows; each row is array of columns.
*/
function parseCSV(text){
  const rows = [];
  let cur = [];
  let field = '';
  let inQuotes = false;
  let i=0;
  while(i < text.length){
    const ch = text[i];
    const nxt = text[i+1];
    if(inQuotes){
      if(ch === '"' && nxt === '"'){ // escaped quote
        field += '"';
        i += 2;
        continue;
      } else if(ch === '"'){ // end quotes
        inQuotes = false;
        i++;
        continue;
      } else {
        field += ch;
        i++;
        continue;
      }
    } else {
      if(ch === '"'){
        inQuotes = true;
        i++;
        continue;
      }
      if(ch === ','){
        cur.push(field);
        field = '';
        i++;
        continue;
      }
      if(ch === '\r'){
        // ignore; handle \r\n on \n
        i++;
        continue;
      }
      if(ch === '\n'){
        cur.push(field);
        rows.push(cur);
        cur = [];
        field = '';
        i++;
        continue;
      }
      field += ch;
      i++;
    }
  }
  // push last
  if(inQuotes === false){
    if(field !== '' || cur.length>0){
      cur.push(field);
      rows.push(cur);
    }
  }
  return rows;
}

/* map header names to indexes (case-insensitive) */
function findHeaderIndex(headers, candidates){
  const lower = headers.map(h => (h||'').toString().trim().toLowerCase());
  for(const cand of candidates){
    const ci = lower.indexOf(cand.toLowerCase());
    if(ci !== -1) return ci;
  }
  return -1;
}

let allFAQs = []; // {id, question, answer, tags:[], order, visible}
let topFAQs = [];

async function fetchAndLoad(){
  try{
    const r = await fetch(FAQ_CSV_URL, {cache: "no-cache"});
    if(!r.ok) throw new Error('fetch_failed');
    const txt = await r.text();
    const rows = parseCSV(txt);
    if(!rows || rows.length < 2) throw new Error('no_rows');
    const headers = rows[0].map(h => (h||'').toString().trim());
    // find indexes
    const idxQuestion = findHeaderIndex(headers, ['question','q']);
    const idxAnswer = findHeaderIndex(headers, ['answer','a']);
    const idxTags = findHeaderIndex(headers, ['tags','tag']);
    const idxOrder = findHeaderIndex(headers, ['order']);
    const idxVisible = findHeaderIndex(headers, ['visible']);
    // Build faqs
    allFAQs = [];
    for(let i=1;i<rows.length;i++){
      const r = rows[i];
      const question = (r[idxQuestion] || '').toString().trim();
      const answer = (r[idxAnswer] || '').toString().trim();
      const tagsRaw = (r[idxTags] || '').toString().trim();
      const orderVal = Number((r[idxOrder]||'').toString().trim()) || 0;
      const visibleRaw = (r[idxVisible] || '').toString().trim().toLowerCase();
      const visible = (visibleRaw === '') ? true : (visibleRaw !== 'false' && visibleRaw !== '0' ? true : false);
      if(!question) continue; // skip blank
      const tags = tagsRaw ? tagsRaw.split(',').map(t=>t.trim().toLowerCase()).filter(Boolean) : [];
      allFAQs.push({
        id: 'faq_' + i,
        question,
        answer,
        tags,
        order: orderVal,
        visible
      });
    }
    // sort for top list (highest order first)
    topFAQs = allFAQs.filter(f=>f.visible).slice().sort((a,b)=> (b.order||0) - (a.order||0)).slice(0,5);
    renderLists();
  }catch(e){
    console.error('Failed to load FAQs:', e);
    alert('Failed to load FAQs. Check the published CSV URL and that the sheet is published as CSV.');
  }
}

function renderLists(){
  const topEl = document.getElementById('topFaqs');
  const allEl = document.getElementById('allFaqs');
  topEl.innerHTML = '';
  allEl.innerHTML = '';
  topFAQs.forEach(f=>{
    const d = document.createElement('div');
    d.className = 'faqItem';
    d.innerText = f.question;
    d.addEventListener('click', ()=> openFAQ(f.id));
    topEl.appendChild(d);
  });
  // all faqs (questions only)
  allFAQs.forEach(f=>{
    const d = document.createElement('div');
    d.className = 'faqItem';
    d.innerText = f.question;
    d.addEventListener('click', ()=> openFAQ(f.id));
    allEl.appendChild(d);
  });
  // update hero if no selection
  showLandingImages();
}

/* show landing images area */
function showLandingImages(){
  document.getElementById('heroBox').style.display = 'flex';
  document.getElementById('landingImages').style.display = 'flex';
  document.getElementById('answerCard').style.display = 'none';
}

/* open a FAQ by id */
function openFAQ(id){
  const f = allFAQs.find(x => x.id === id);
  if(!f) return;
  // highlight selected in lists
  document.querySelectorAll('.faqItem').forEach(el => el.classList.remove('active'));
  Array.from(document.querySelectorAll('.faqItem')).forEach(el=>{
    if(el.innerText && el.innerText.trim() === f.question.trim()) el.classList.add('active');
  });
  // hide landing images
  document.getElementById('landingImages').style.display = 'none';
  // show answer card
  document.getElementById('answerCard').style.display = 'block';
  document.getElementById('heroBox').style.display = 'block';
  // set title and answer
  document.getElementById('qaTitle').innerText = f.question;
  // preserve line breaks safely
  document.getElementById('qaBody').innerText = f.answer || '-';
  // status - try to map tags/status if present (if tags include statuses like pending/review)
  const statusChip = document.getElementById('statusChip');
  const lastUpdated = document.getElementById('lastUpdated');
  statusChip.style.display = 'none';
  lastUpdated.style.display = 'none';
  // show helpful area etc
  // scroll into view
  setTimeout(()=> { document.getElementById('answerCard').scrollIntoView({behavior:'smooth', block:'start'}); }, 50);
}

/* search by query (matches question, answer, tags) */
let searchTimer;
function onSearch(e){
  clearTimeout(searchTimer);
  searchTimer = setTimeout(()=>{
    const q = (document.getElementById('searchInput').value || '').trim().toLowerCase();
    if(!q){ renderLists(); return; }
    // match: question or answer contains q or any tag contains q
    const matches = allFAQs.filter(f => {
      if(!f.visible) return false;
      if((f.question||'').toLowerCase().includes(q)) return true;
      if((f.answer||'').toLowerCase().includes(q)) return true;
      if((f.tags||[]).some(t => t.includes(q))) return true;
      return false;
    });
    // show matched in top and all area
    const topEl = document.getElementById('topFaqs'); topEl.innerHTML = '';
    const allEl = document.getElementById('allFaqs'); allEl.innerHTML = '';
    matches.slice(0,5).forEach(f=>{
      const d = document.createElement('div'); d.className='faqItem'; d.innerText = f.question; d.addEventListener('click',()=>openFAQ(f.id)); topEl.appendChild(d);
    });
    matches.forEach(f=>{
      const d = document.createElement('div'); d.className='faqItem'; d.innerText = f.question; d.addEventListener('click',()=>openFAQ(f.id)); allEl.appendChild(d);
    });
    // show all block
    document.getElementById('allFaqs').style.display = 'block';
    document.getElementById('toggleAll').innerText = '‚ñæ';
  }, 220);
}

/* helpers for toggles */
document.getElementById('refreshBtn').addEventListener('click', ()=>{
  fetchAndLoad().then(()=> showToast('Refreshed'));
});
document.getElementById('searchInput').addEventListener('input', onSearch);

document.getElementById('toggleAll').addEventListener('click', ()=>{
  const a = document.getElementById('allFaqs');
  const t = document.getElementById('toggleAll');
  if(a.style.display === 'none' || a.style.display === ''){ a.style.display = 'block'; t.innerText = '‚ñæ'; } else { a.style.display = 'none'; t.innerText = '‚ñ∏'; }
});
document.getElementById('viewAllBtn').addEventListener('click', (ev)=>{
  ev.preventDefault();
  const a = document.getElementById('allFaqs');
  a.style.display = 'block';
  document.getElementById('toggleAll').innerText = '‚ñæ';
  a.scrollIntoView({behavior:'smooth', block:'start'});
});

/* small toast */
function showToast(msg){
  const t = document.createElement('div');
  t.style.position='fixed'; t.style.bottom='24px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
  t.style.padding='10px 14px'; t.style.background='#111'; t.style.color='#fff'; t.style.borderRadius='8px'; t.style.zIndex=9999;
  t.innerText = msg; document.body.appendChild(t); setTimeout(()=>t.remove(),1500);
}

/* initialize */
fetchAndLoad();
</script>
</body>
</html>
