<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FAQs ‚Äî BA Information Technology Services</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --accent:#0f62fe;
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6c7680;
      --border:#e6e9ee;
      --maxw:1150px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{max-width:var(--maxw);margin:18px auto;padding:12px;}
    /* Banner: center and contain the header image so it won't crop */
    .banner{display:flex;align-items:center;justify-content:center;border-radius:10px;overflow:hidden;background:#111;padding:8px;margin-bottom:14px;box-shadow:0 8px 30px rgba(6,16,48,0.06)}
    .banner img{width:100%;height:auto;max-height:260px;object-fit:contain;display:block}

    .layout{display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:start;}
    @media(max-width:920px){ .layout{grid-template-columns:1fr} }

    .left{
      background:var(--card);
      border-radius:12px;
      padding:14px;
      box-shadow:0 8px 26px rgba(10,20,40,0.04);
      border:1px solid var(--border);
      height:100%;
    }
    .right{
      background:transparent;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .heading{font-size:20px;font-weight:800;margin:4px 0 12px 0;color:#0b1220}
    .searchBox{display:flex;gap:8px;align-items:center;background:#f2f4f8;padding:10px;border-radius:12px;border:1px solid var(--border)}
    .searchBox input{border:0;outline:none;background:transparent;font-size:14px;width:100%}

    .top5Title{font-weight:800;margin:14px 0 8px 0}
    .list{display:flex;flex-direction:column;gap:8px;max-height:420px;overflow:auto;padding-right:6px}
    .faqItem{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px;cursor:pointer;transition:all .22s; text-decoration:none;color:inherit}
    .faqItem:hover{background:rgba(15,98,254,0.04);transform:translateY(-2px)}
    .faqItem strong{font-size:14px}

    .imagesCard{background:var(--card);border-radius:10px;padding:12px;border:1px solid var(--border);box-shadow:0 10px 24px rgba(10,20,40,0.03)}
    .imgWrap{height:360px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid var(--border)}
    .imgWrap img{max-width:100%;max-height:100%;object-fit:contain;display:block;opacity:0;transition:opacity .36s ease-in-out}

    .qaCard{background:var(--card);border-radius:12px;padding:18px;border:1px solid var(--border);box-shadow:0 8px 28px rgba(10,20,40,0.04)}
    .qaTitle{font-size:24px;font-weight:800;margin-bottom:8px;color:#0c2446}
    .qaBody{font-size:15px;color:#333;white-space:pre-wrap;line-height:1.6;padding:12px;border-radius:8px;background:#fff;border:1px solid var(--border);min-height:160px;opacity:0;transform:translateY(8px);transition:all .32s ease}
    .qaBody.show{opacity:1;transform:none}

    .actionsRow{display:flex;gap:10px;align-items:center;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--accent)}
    .small{font-size:13px;color:var(--muted)}

    .ratingRow{display:flex;gap:8px;margin-top:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#f3f6ff;border:1px solid #e9f0ff;font-weight:700;color:#0b3a91}

    .allToggle{cursor:pointer;color:var(--muted);font-weight:700;margin-top:8px}
    .footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    .suggestBox{position:absolute;left:0;right:0;background:#fff;border:1px solid var(--border);border-radius:10px;z-index:80;max-height:260px;overflow:auto;padding:6px;margin-top:6px;box-shadow:0 12px 36px rgba(10,20,40,0.06)}
    .suggestItem{padding:8px;border-radius:8px;cursor:pointer}
    .suggestItem:hover{background:#f4f7ff}

    /* small responsive tweaks */
    @media (max-width:560px){
      .imgWrap{height:220px}
      .qaBody{min-height:120px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="banner">
      <!-- header.png must be in the same repo folder -->
      <img id="headerImg" src="header.png" alt="BA Information Technology Services">
    </div>

    <div class="layout">
      <div class="left">
        <div class="heading">Frequently Asked Questions</div>

        <div style="position:relative;margin-bottom:10px;">
          <div class="searchBox">
            <svg width="16" height="16" viewBox="0 0 24 24" style="flex:0 0 18px"><path d="M21 21l-4.35-4.35" stroke="#444" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <input id="searchInput" placeholder="Search FAQs (question or answer)" autocomplete="off">
            <button id="refreshBtn" class="btn ghost" style="margin-left:6px">Refresh</button>
          </div>
          <div id="suggestions" style="display:none"></div>
        </div>

        <div class="top5Title">Top FAQs</div>
        <div id="top5" class="list"></div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800">All FAQs</div>
          <div class="allToggle" id="toggleAllBtn">‚ñæ</div>
        </div>
        <div id="allList" class="list" style="margin-top:8px;max-height:360px"></div>
      </div>

      <div class="right">
        <div class="imagesCard">
          <div class="imgWrap" id="imgWrap">
            <img id="rightImage" alt="FAQ image"/>
          </div>
        </div>

        <div id="qaCard" class="qaCard">
          <div id="qaTitle" class="qaTitle">Select a question to view the answer</div>
          <div id="qaBody" class="qaBody">Answers will appear here.</div>

          <div class="ratingRow" style="margin-top:14px">
            <div id="approveBtn" class="pill" title="Click to say this was helpful">üëç Helpful</div>
            <div id="disapproveBtn" class="pill" title="Click to say this was not helpful">üëé Not helpful</div>
            <div style="flex:1"></div>
            <div class="small">Your feedback helps us improve ‚Äî thank you.</div>
          </div>

          <div class="actionsRow">
            <button id="openAllBtn" class="btn ghost">View all FAQs (expand)</button>
            <button id="exitBtn" class="btn primary" style="margin-left:auto">Close</button>
          </div>
        </div>

      </div>
    </div>

    <div class="footer">BA Information Technology Services</div>
  </div>

<script>
/*
  Robust client-side FAQs reader for a published Google Sheet CSV.

  Important: use the published CSV URL for the FAQs sheet (you provided).
  Make sure the URL ends with &output=csv (this code expects CSV).
*/
const FAQ_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQOB7XYnfn0V6i8HkQQc7nXDv7nDL-s0TN_tJdpBU-tQgOQh-4sTv6vOc5_CZf6ldK5RsjcAZfiMTiD/pub?gid=0&single=true&output=csv";

// admin email used by feedback mailto (optional change)
const ADMIN_EMAIL = "baits2k23@gmail.com";

/* --- Utility CSV parsing (handles quoted fields) --- */
function parseCsv(text){
  const lines = text.split(/\r?\n/).filter(l=>l.trim().length>0);
  return lines.map(line => {
    // split on commas not in quotes
    const cols = line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/^"(.*)"$/, '$1'));
    return cols;
  });
}

// Normalize header keys to lower-case trimmed
function headerIndex(row){
  const map = {};
  row.forEach((h,i)=>{
    const key = String(h||'').toLowerCase().trim();
    map[key] = i;
  });
  return map;
}

// Build FAQ objects from CSV rows (robust header mapping)
function buildFaqObjects(rows){
  // rows[0] is header row
  const header = rows[0].map(h => String(h||'').trim());
  const idx = headerIndex(header);

  // helper to find likely column index by variants
  function findIndex(variants){
    for(const v of variants){
      if(idx.hasOwnProperty(v)) return idx[v];
    }
    return -1;
  }

  // likely header name variants (covers your sheet)
  const i_id = findIndex(['id']);
  const i_question = findIndex(['question','q']);
  const i_answer = findIndex(['answer','a']);
  const i_image = findIndex(['imageurl','image url','image','imageurls']);
  const i_order = findIndex(['order','sort']);
  const i_visible = findIndex(['visible','show','isvisible']);

  const out = [];
  for(let r=1;r<rows.length;r++){
    const raw = rows[r];
    // get field using index or fallback by position
    const question = (i_question>=0 ? raw[i_question] : raw[1]) || '';
    if(String(question).trim() === '') continue; // skip empty questions
    const visibleRaw = (i_visible>=0 ? raw[i_visible] : '') || '';
    // treat visible absent as true; if present, check false values
    const visible = String(visibleRaw||'').toLowerCase().trim();
    if(visible === 'false' || visible === '0' || visible === 'no') continue; // skip not-visible
    const obj = {
      id: (i_id>=0 ? raw[i_id] : '') || (Math.random().toString(36).slice(2,9)),
      question: String(question||'').trim(),
      answer: String(i_answer>=0 ? raw[i_answer] : raw[2] || '').trim(),
      imageUrls: String(i_image>=0 ? raw[i_image] : raw[4] || '').trim(),
      order: Number(i_order>=0 ? (raw[i_order]||0) : (raw[5]||0)) || 0,
      rawRow: raw
    };
    out.push(obj);
  }
  // sort by order descending (higher order first)
  out.sort((a,b)=> (b.order||0) - (a.order||0));
  return out;
}

// Extract Drive ID (if Google Drive link used) and return uc link if possible
function toImageUrl(url){
  if(!url) return '';
  url = String(url).trim();
  const m = url.match(/\/d\/([a-zA-Z0-9_-]{10,})/);
  if(m && m[1]) return 'https://drive.google.com/uc?export=view&id=' + m[1];
  const q = url.match(/[?&]id=([a-zA-Z0-9_-]{10,})/);
  if(q && q[1]) return 'https://drive.google.com/uc?export=view&id=' + q[1];
  // if it's already a uc link or direct http(s), return as-is
  if(url.indexOf('http') === 0) return url;
  return '';
}

/* === UI elements === */
const top5El = document.getElementById('top5');
const allListEl = document.getElementById('allList');
const qaTitleEl = document.getElementById('qaTitle');
const qaBodyEl = document.getElementById('qaBody');
const rightImgEl = document.getElementById('rightImage');
const headerImgEl = document.getElementById('headerImg');
const searchInput = document.getElementById('searchInput');
const suggestionsWrap = document.getElementById('suggestions');

let allFaqs = [];
let visibleFaqs = [];
let currentFaq = null;

/* === Render helpers === */
function escapeHtml(s){ return String(s||'').replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

function renderTop5(){
  top5El.innerHTML = '';
  const top = visibleFaqs.slice(0,5);
  top.forEach(f=>{
    const item = document.createElement('a');
    item.className = 'faqItem';
    item.href = 'javascript:void(0)';
    item.innerHTML = '<strong>' + escapeHtml(f.question) + '</strong>';
    item.addEventListener('click', ()=> openFaq(f));
    top5El.appendChild(item);
  });
}

function renderAll(list){
  allListEl.innerHTML = '';
  (list || visibleFaqs).forEach(f=>{
    const item = document.createElement('a');
    item.className = 'faqItem';
    item.href = 'javascript:void(0)';
    item.innerHTML = '<div style="flex:1"><strong>' + escapeHtml(f.question) + '</strong></div>';
    item.addEventListener('click', ()=> openFaq(f));
    allListEl.appendChild(item);
  });
}

function showImage(url){
  if(!url){ rightImgEl.src = 'https://via.placeholder.com/1200x720?text=No+image'; rightImgEl.style.opacity = 1; return; }
  const final = toImageUrl(url);
  rightImgEl.style.opacity = 0;
  // preload, then show (smooth)
  const img = new Image();
  img.onload = function(){
    rightImgEl.src = final;
    setTimeout(()=> rightImgEl.style.opacity = 1, 40);
  };
  img.onerror = function(){ rightImgEl.src = 'https://via.placeholder.com/1200x720?text=No+image'; rightImgEl.style.opacity = 1; };
  img.src = final || url;
}

function openFaq(f){
  currentFaq = f;
  qaTitleEl.textContent = f.question || 'No question';
  qaBodyEl.textContent = f.answer || '-';
  // animate reveal
  requestAnimationFrame(()=> qaBodyEl.classList.add('show'));
  // show first image (if any)
  const list = (f.imageUrls||'').split('|').map(s=>s.trim()).filter(Boolean);
  showImage(list.length ? list[0] : '');
}

/* === Search/suggestions === */
let searchTimer = null;
searchInput.addEventListener('input', (e)=>{
  clearTimeout(searchTimer);
  const q = (e.target.value||'').trim();
  if(!q){
    if(visibleFaqs.length) renderAll();
    suggestionsWrap.style.display = 'none';
    return;
  }
  searchTimer = setTimeout(()=>{
    const lower = q.toLowerCase();
    const matches = visibleFaqs.filter(f => (f.question + ' ' + f.answer).toLowerCase().indexOf(lower) !== -1).slice(0,12);
    suggestionsWrap.style.display = matches.length ? 'block' : 'none';
    suggestionsWrap.innerHTML = '<div class="suggestBox"></div>';
    const box = suggestionsWrap.querySelector('.suggestBox');
    matches.forEach(it=>{
      const d = document.createElement('div');
      d.className = 'suggestItem';
      d.textContent = it.question;
      d.addEventListener('click', ()=>{ openFaq(it); suggestionsWrap.style.display='none'; searchInput.value=''; });
      box.appendChild(d);
    });
    renderAll(matches);
  }, 180);
});

/* === Buttons === */
document.getElementById('refreshBtn').addEventListener('click', ()=> loadFaqs(true));
document.getElementById('openAllBtn').addEventListener('click', ()=>{
  document.getElementById('allList').style.display = 'block';
  document.getElementById('toggleAllBtn').textContent = '‚ñæ';
  window.scrollTo({top:0,behavior:'smooth'});
});
document.getElementById('toggleAllBtn').addEventListener('click', ()=>{
  const a = document.getElementById('allList');
  if(!a.style.display || a.style.display === 'none'){ a.style.display = 'block'; document.getElementById('toggleAllBtn').textContent = '‚ñæ'; }
  else { a.style.display = 'none'; document.getElementById('toggleAllBtn').textContent = '‚ñ∏'; }
});
document.getElementById('exitBtn').addEventListener('click', ()=>{
  qaTitleEl.textContent = 'Select a question to view the answer';
  qaBodyEl.textContent = 'Answers will appear here.';
  qaBodyEl.classList.remove('show');
  showImage('');
});

/* feedback: open mailto with FAQ info (simple) */
document.getElementById('approveBtn').addEventListener('click', ()=>{
  if(!currentFaq){ alert('Please select a question first.'); return; }
  const subject = encodeURIComponent('FAQ Feedback ‚Äî Helpful: ' + (currentFaq.id || currentFaq.question));
  const body = encodeURIComponent('FAQ ID: ' + (currentFaq.id || '') + '\nQuestion: ' + (currentFaq.question || '') + '\n\nI found this helpful.\n');
  window.location.href = 'mailto:' + ADMIN_EMAIL + '?subject=' + subject + '&body=' + body;
});
document.getElementById('disapproveBtn').addEventListener('click', ()=>{
  if(!currentFaq){ alert('Please select a question first.'); return; }
  const subject = encodeURIComponent('FAQ Feedback ‚Äî Not helpful: ' + (currentFaq.id || currentFaq.question));
  const body = encodeURIComponent('FAQ ID: ' + (currentFaq.id || '') + '\nQuestion: ' + (currentFaq.question || '') + '\n\nThis was not helpful because:\n- ');
  window.location.href = 'mailto:' + ADMIN_EMAIL + '?subject=' + subject + '&body=' + body;
});

/* === Fetch + initialize === */
async function loadFaqs(force=false){
  try{
    const res = await fetch(FAQ_CSV_URL, {cache: force ? 'no-store' : 'default'});
    if(!res.ok) throw new Error('fetch failed: ' + res.status);
    const txt = await res.text();
    const rows = parseCsv(txt);
    if(rows.length < 2){ top5El.innerHTML = '<div class="small">No FAQs found.</div>'; allListEl.innerHTML = ''; return; }
    const objs = buildFaqObjects(rows);
    allFaqs = objs;
    visibleFaqs = allFaqs.filter(Boolean);
    renderTop5();
    renderAll();
    // pick first visible faq to open
    if(visibleFaqs.length) openFaq(visibleFaqs[0]);
    else showImage('');
  } catch(err){
    console.error(err);
    top5El.innerHTML = '<div class="small">Unable to load FAQs. Confirm the published CSV URL and network.</div>';
    allListEl.innerHTML = '';
    showImage('');
  }
}

// hide suggestions when clicking outside
window.addEventListener('click', (ev)=>{
  const s = document.getElementById('suggestions');
  if(!s) return;
  if(!s.contains(ev.target) && ev.target !== searchInput) s.style.display='none';
});

// initial load
loadFaqs();
</script>
</body>
</html>
