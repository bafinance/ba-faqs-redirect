<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Follow-up Ticket Status â€” BA Information Technology Services</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --blue:#0a6bff;
      --purple:#7c3aed;
      --brown:#a16207;
      --red:#d93025;
      --green:#16a34a;
      --muted:#6c7680;
      --card:#ffffff;
      --bg:#f4f6fb;
      --maxw:920px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,Arial,Helvetica,sans-serif;
      background:var(--bg);
      color:#111;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .page{
      max-width:var(--maxw);
      margin:28px auto;
      padding:0 18px;
    }

    /* header image */
    .header-wrap{
      background:transparent;
      display:flex;
      justify-content:center;
      margin-bottom:18px;
    }
    .header-wrap img{
      width:100%;
      max-width:900px;
      height:auto;
      border-radius:6px;
      box-shadow:0 6px 28px rgba(10,20,40,0.06);
      display:block;
    }

    .faq-row{
      text-align:center;
      margin:10px 0 18px;
    }
    .faq-row a{
      color:var(--blue);
      text-decoration:none;
      font-weight:700;
      font-size:15px;
      padding:6px 10px;
      border-radius:6px;
    }

    .card{
      background:var(--card);
      border-radius:14px;
      padding:22px;
      box-shadow:0 10px 28px rgba(12,24,48,0.06);
    }
    h1{
      margin:0 0 6px 0;
      font-size:20px;
      color:#0e2460;
    }
    .hint{
      color:var(--muted);
      font-size:14px;
      margin-bottom:14px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr 280px;
      gap:14px;
      align-items:start;
    }

    label{ display:block; font-weight:600; color:#333; font-size:13px; margin-bottom:6px; }
    input[type="text"]{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #e6e9ef;
      font-size:14px;
      outline:none;
    }
    input[type="text"]:focus{ box-shadow:0 0 0 4px rgba(10,107,255,0.08); border-color:var(--blue); }

    .actions{
      margin-top:14px;
      display:flex;
      gap:12px;
      align-items:center;
    }
    .btn{
      display:inline-block;
      background:var(--blue);
      color:#fff;
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      text-decoration:none;
      border:none;
      cursor:pointer;
    }
    .btn.secondary{
      background:transparent;
      color:var(--blue);
      font-weight:700;
      text-decoration:underline;
      padding:0;
      border:0;
      cursor:pointer;
    }

    .msg{
      margin-top:12px;
      font-weight:700;
      color:#0a6b2a;
    }
    .error{
      margin-top:12px;
      font-weight:700;
      color:var(--red);
    }

    .ticket{
      margin-top:20px;
      background:#fbfdff;
      border-radius:10px;
      border:1px solid #e8eef7;
      padding:18px;
    }
    .ticket .row{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
    }
    .ticket .left{flex:1; min-width:0}
    .ticket .right{width:240px; text-align:right}

    .label{ font-weight:700; color:#25304a; margin-bottom:8px; display:block }
    .value{ color:#1a2438; font-size:15px; margin-bottom:12px; line-height:1.4; min-height:18px }

    .status-chip{
      display:inline-block;
      padding:8px 12px;
      border-radius:12px;
      color:#fff;
      font-weight:800;
      font-size:13px;
      box-shadow:0 6px 18px rgba(10,20,40,0.05);
    }
    .pending { background:var(--blue); }
    .reviewing { background:var(--purple); }
    .clarification { background:var(--brown); }
    .failed { background:var(--red); }
    .succeeded { background:var(--green); }

    .meta { color:var(--muted); font-size:13px; margin-top:6px; }

    footer {
      text-align:center;
      margin:28px 0 80px 0;
      color:#b6bec7;
      font-size:13px;
    }

    @media (max-width:820px){
      .grid{ grid-template-columns:1fr; }
      .ticket .right{ text-align:left; width:auto; margin-top:12px }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="header-wrap">
      <img src="header.png" alt="BA Information Technology Services">
    </div>

    <div class="faq-row">
      <a href="https://script.google.com/macros/s/AKfycbwCinvx9cDyEk5J8wckWNbaikP7lL_J08R-HTVC2QUUfD2nYf-BDWRjdQcddcXJor8LOA/exec" target="_blank" rel="noopener">
        Frequently Asked Questions (FAQs)
      </a>
    </div>

    <div class="card">
      <h1>Follow-up Ticket Status</h1>
      <div class="hint">Enter the <strong>Complete name</strong> you used in the form and your <strong>Ticket number</strong>.</div>

      <div class="grid">
        <div>
          <label>Complete name (from the form)</label>
          <input id="clientName" type="text" placeholder="Type full name exactly as submitted">

          <label style="margin-top:12px">Ticket number</label>
          <input id="ticketNumber" type="text" placeholder="e.g. BA-0016">
          
          <div class="actions">
            <button class="btn" id="checkBtn">Check Ticket</button>
            <a class="btn secondary" href="https://forms.gle/QrGB6FrsphuRS8Bo9" target="_blank">Submit a Concern</a>
          </div>

          <div id="msg" class="msg" style="display:none">Ticket loaded.</div>
          <div id="err" class="error" style="display:none"></div>
        </div>

        <div></div>
      </div>

      <div id="ticketArea" class="ticket" style="display:none"></div>
    </div>

    <footer>BA Information Technology Services</footer>
  </div>

<script>
const TICKET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfRBiFS4R36jzmtv0eMcVEkpqxpgNoI_dJ0DQRUO-lJ_Un_dYNqmYbl0agA4l7V9565ECHuvKKzMM1/pub?gid=60269729&single=true&output=csv";

function normalize(v){ return String(v||'').trim().toLowerCase(); }

function mapStatusClass(s){
  s = normalize(s);
  if(s.includes('pending')) return 'pending';
  if(s.includes('review')) return 'reviewing';
  if(s.includes('clar')) return 'clarification';
  if(s.includes('fail')) return 'failed';
  if(s.includes('success')) return 'succeeded';
  return 'pending';
}

function parseCsv(txt){
  const rows = txt.split(/\r?\n/).filter(r=>r.trim().length>0);
  return rows.map(r=>{
    return r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c=>{
      c = c.replace(/^"(.*)"$/, '$1');
      return c;
    });
  });
}

async function fetchTickets(){
  const res = await fetch(TICKET_CSV_URL);
  const txt = await res.text();
  return parseCsv(txt);
}

document.getElementById('checkBtn').addEventListener('click', async ()=>{

  const name = normalize(document.getElementById('clientName').value);
  const ticket = normalize(document.getElementById('ticketNumber').value);

  if(!name || !ticket){
    showErr("Please enter both Complete name and Ticket number.");
    return;
  }

  try{
    const rows = await fetchTickets();
    if(rows.length < 2){
      showErr("No ticket data found.");
      return;
    }

    const headers = rows[0].map(h=>normalize(h));

    const idx_ticket = headers.indexOf('ticket');
    const idx_client = headers.indexOf('client name');
    const idx_timestamp = headers.indexOf('timestamp');
    const idx_location = headers.indexOf('service location');
    const idx_concern = headers.indexOf('concern');
    const idx_status = headers.indexOf('status');
    const idx_assigned = headers.indexOf('assigned to');
    const idx_resolved = headers.indexOf('resolved at');
    const idx_internal = headers.indexOf('internal notes');
    const idx_lastUpdated = headers.indexOf('last updated');

    let found = null;

    for(let i=1;i<rows.length;i++){
      const r = rows[i];
      if(!r[idx_ticket] || !r[idx_client]) continue;

      if(normalize(r[idx_ticket]) === ticket && normalize(r[idx_client]) === name){
        found = {
          ticket: r[idx_ticket] || '-',
          client: r[idx_client] || '-',
          timestamp: r[idx_timestamp] || '-',
          location: r[idx_location] || '-',
          concern: r[idx_concern] || '-',
          status: r[idx_status] || '-',
          assigned: r[idx_assigned] || '-',
          resolved: r[idx_resolved] || '-',
          internal: r[idx_internal] || '-',
          lastUpdated: r[idx_lastUpdated] || '-'
        };
        break;
      }
    }

    if(!found){
      showErr("No matching ticket found. Check your spelling and ticket number.");
      return;
    }

    showMsg();
    renderTicket(found);

  } catch(e){
    showErr("Could not fetch Tickets.");
  }
});

function showMsg(){
  document.getElementById('msg').style.display='block';
  document.getElementById('err').style.display='none';
}

function showErr(t){
  const err = document.getElementById('err');
  err.style.display='block';
  err.textContent=t;
  document.getElementById('msg').style.display='none';
  document.getElementById('ticketArea').style.display='none';
}

function renderTicket(f){
  const box = document.getElementById('ticketArea');
  box.style.display='block';

  const statusClass = mapStatusClass(f.status);

  box.innerHTML = `
    <div class="row">
      <div class="left">
        <div><span class="label">Ticket</span><div class="value"><strong>${f.ticket}</strong></div></div>
        <div><span class="label">Client</span><div class="value">${f.client}</div></div>
        <div><span class="label">Submitted</span><div class="value">${f.timestamp}</div></div>
        <div><span class="label">Service Location</span><div class="value">${f.location}</div></div>
        <div><span class="label">Concern</span><div class="value">${f.concern}</div></div>
        <div><span class="label">Internal Notes</span><div class="value">${f.internal}</div></div>
      </div>

      <div class="right">
        <div class="status-chip ${statusClass}">${f.status}</div>
        <div style="height:12px"></div>

        <div><span class="label">Assigned To</span><div class="value">${f.assigned}</div></div>
        <div><span class="label">Resolved at</span><div class="value">${f.resolved}</div></div>
        <div><span class="label">Last Updated</span><div class="meta">${f.lastUpdated}</div></div>
      </div>
    </div>
  `;
}
</script>
</body>
</html>
