<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BA Support Ticket Status</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f4f6fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background: white;
      padding: 25px 30px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    h1 {
      text-align: center;
      color: #0a2f66;
      margin-bottom: 8px;
      font-size: 26px;
    }
    .sub {
      text-align: center;
      color: #444;
      font-size: 14px;
      margin-bottom: 14px;
    }

    /* ---- FAQ LINK ---- */
    .faq-link {
      text-align: center;
      margin-top: -5px;
      margin-bottom: 25px;
    }
    .faq-link a {
      color: #0a6bff;
      font-weight: 700;
      text-decoration: none;
      font-size: 14px;
    }
    .faq-link a:hover {
      text-decoration: underline;
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 14px;
      color: #333;
    }
    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 6px;
      font-size: 14px;
    }
    button {
      width: 100%;
      background: #0a6bff;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      margin-top: 20px;
      cursor: pointer;
    }
    button:hover {
      background: #084ec7;
    }
    .error {
      margin-top: 14px;
      color: #d93025;
      font-weight: 700;
      text-align: center;
    }
    .ticket-box {
      margin-top: 25px;
      background: #f4f6fc;
      padding: 16px;
      border-radius: 10px;
      border: 1px solid #d9e2ef;
    }
    .ticket-box div {
      margin: 6px 0;
    }
    .label {
      font-weight: 700;
      color: #0a2f66;
    }

    /* STATUS COLOR TAG */
    .status-tag {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      color: white;
      float: right;
    }

    .pending { background:#f59e0b; }
    .reviewing { background:#0a6bff; }
    .clarifying { background:#f59e0b; }
    .failed { background:#d93025; }
    .succeeded { background:#16a34a; }
  </style>
</head>

<body>
  <div class="container">
    <h1>BA Information Technology Services</h1>
    <div class="sub">Support Ticket Status Portal</div>

    <!-- FAQ LINK HERE -->
    <div class="faq-link">
      <a href="https://script.google.com/macros/s/AKfycbwCinvx9cDyEk5J8wckWNbaikP7lL_J08R-HTVC2QUUfD2nYf-BDWRjdQcddcXJor8LOA/exec"
         target="_blank">
        Frequently Asked Questions (FAQs)
      </a>
    </div>

    <label>Complete Name (as submitted in the form)</label>
    <input id="clientName" type="text" placeholder="Enter full name">

    <label>Ticket Number</label>
    <input id="ticketNumber" type="text" placeholder="Example: BA-0016">

    <button onclick="lookupTicket()">Check Ticket Status</button>

    <div id="errorMsg" class="error"></div>
    <div id="ticketResult"></div>
  </div>

  <script>
    const TICKET_CSV =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfRBiFS4R36jzmtv0eMcVEkpqxpgNoI_dJ0DQRUO-lJ_Un_dYNqmYbl0agA4l7V9565ECHuvKKzMM1/pub?gid=60269729&single=true&output=csv";

    function normalize(str) {
      return String(str || "").trim().toLowerCase();
    }

    function statusClass(s) {
      s = s.toLowerCase();
      if (s.includes("pending")) return "pending";
      if (s.includes("review")) return "reviewing";
      if (s.includes("clar")) return "clarifying";
      if (s.includes("fail")) return "failed";
      if (s.includes("succeed") || s.includes("success")) return "succeeded";
      return "";
    }

    async function lookupTicket() {
      document.getElementById("errorMsg").innerHTML = "";
      document.getElementById("ticketResult").innerHTML = "";

      const name = normalize(document.getElementById("clientName").value);
      const ticket = normalize(document.getElementById("ticketNumber").value);

      if (!name || !ticket) {
        document.getElementById("errorMsg").innerHTML =
          "Please enter both name and ticket number.";
        return;
      }

      try {
        const res = await fetch(TICKET_CSV);
        const data = await res.text();
        const rows = data.split("\n").map(r => r.split(","));

        let found = null;

        for (let i = 1; i < rows.length; i++) {
          const r = rows[i].map(x => x.trim());

          const tTicket = normalize(r[0]);
          const tEmail = r[2];
          const tName = normalize(r[3]);
          const tLoc  = r[4];
          const tP    = r[5];
          const tCon  = r[6];
          const tStat = r[7];
          const tAssign = r[8];
          const tResolved = r[9];
          const tNotes = r[10];
          const tUpdated = r[13];

          if (ticket === tTicket && name === tName) {
            found = { tTicket, tEmail, tName, tLoc, tP, tCon, tStat, tAssign, tResolved, tNotes, tUpdated };
            break;
          }
        }

        if (!found) {
          document.getElementById("errorMsg").innerHTML =
            "Ticket not found â€” please make sure your name and ticket number match exactly.";
          return;
        }

        const sClass = statusClass(found.tStat);

        document.getElementById("ticketResult").innerHTML = `
          <div class="ticket-box">
            <div class="status-tag ${sClass}">${found.tStat || "-"}</div>
            <div><span class="label">Ticket Number:</span> ${found.tTicket}</div>
            <div><span class="label">Client Name:</span> ${found.tName || "-"}</div>
            <div><span class="label">Location:</span> ${found.tLoc || "-"}</div>
            <div><span class="label">Concern:</span> ${found.tCon || "-"}</div>
            <div><span class="label">Assigned To:</span> ${found.tAssign || "-"}</div>
            <div><span class="label">Resolved At:</span> ${found.tResolved || "-"}</div>
            <div><span class="label">Internal Notes:</span> ${found.tNotes || "-"}</div>
            <hr style="margin:12px 0;">
            <div><span class="label">Last Updated:</span> ${found.tUpdated || "-"}</div>
          </div>
        `;
      } catch (err) {
        document.getElementById("errorMsg").innerHTML =
          "Error loading ticket data.";
      }
    }
  </script>
</body>
</html>
